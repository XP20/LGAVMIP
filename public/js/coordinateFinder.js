let latvia = [{lng: 22.61689028396331, lat: 57.80119834781119}, {lng: 22.45030300719313, lat: 57.78790958063669}, {lng: 22.31405328946476, lat: 57.7377211183072}, {lng: 22.08848886929916, lat: 57.69640632229839}, {lng: 21.78794272430912, lat: 57.64915992457119}, {lng: 21.627572069779, lat: 57.56493045666855}, {lng: 21.46626926999868, lat: 57.44338610357507}, {lng: 21.31135803433033, lat: 57.29478120936565}, {lng: 21.2540785129932, lat: 57.16092404661387}, {lng: 21.13783641563074, lat: 56.98491325920224}, {lng: 20.95354405054487, lat: 56.87001470040045}, {lng: 20.95016827982, lat: 56.70543848268464}, {lng: 20.91633523453221, lat: 56.59920357913938}, {lng: 20.8361569598067, lat: 56.44363989506202}, {lng: 20.88706061046473, lat: 56.29234853750529}, {lng: 20.91691492214648, lat: 56.20857138066712}, {lng: 21.02554830775577, lat: 56.07902382069467}, {lng: 21.08427236548021, lat: 56.08132980096437}, {lng: 21.12813828378921, lat: 56.09065290420306}, {lng: 21.20034105037034, lat: 56.10001053666547}, {lng: 21.21212630872374, lat: 56.11658297084409}, {lng: 21.21174643814063, lat: 56.13570805611349}, {lng: 21.21097899341352, lat: 56.15854741608602}, {lng: 21.25524813427582, lat: 56.19482530675132}, {lng: 21.28640717335917, lat: 56.22115691611074}, {lng: 21.32275470895958, lat: 56.23374521490931}, {lng: 21.37457728848513, lat: 56.2415577642234}, {lng: 21.43326024573459, lat: 56.27665461064584}, {lng: 21.46149531459838, lat: 56.29622277335172}, {lng: 21.48846109707491, lat: 56.30950042962554}, {lng: 21.53925534220538, lat: 56.32969598071158}, {lng: 21.58764073124501, lat: 56.33520031872536}, {lng: 21.64202781671527, lat: 56.33668561271504}, {lng: 21.6857021418049, lat: 56.33161148738373}, {lng: 21.72747091570562, lat: 56.34839235405831}, {lng: 21.76176007510207, lat: 56.36494689678727}, {lng: 21.79998583888175, lat: 56.3795084042287}, {lng: 21.84288126797194, lat: 56.3837286863146}, {lng: 21.87545808898221, lat: 56.39913164002949}, {lng: 21.91183694701385, lat: 56.39168786596466}, {lng: 21.9484236888851, lat: 56.40506563787733}, {lng: 21.95437678366499, lat: 56.42499010323624}, {lng: 21.99650974776469, lat: 56.44057090036366}, {lng: 22.08116335495166, lat: 56.44461153626058}, {lng: 22.15694762586296, lat: 56.44009112276977}, {lng: 22.22694406771696, lat: 56.43747791363558}, {lng: 22.28237284907405, lat: 56.42825025391677}, {lng: 22.34842089435343, lat: 56.42860294655528}, {lng: 22.42413798490293, lat: 56.42598855067275}, {lng: 22.54211434722696, lat: 56.41474413864006}, {lng: 22.65248041094472, lat: 56.40269263144643}, {lng: 22.9444599684938, lat: 56.44120599780936}, {lng: 23.03022889228864, lat: 56.42375150288889}, {lng: 23.10166921976526, lat: 56.36382480968819}, {lng: 23.18430305315188, lat: 56.39844031311659}, {lng: 23.33534582742543, lat: 56.41662065938338}, {lng: 23.52144343634446, lat: 56.36709345235015}, {lng: 23.83960410343368, lat: 56.41241882574645}, {lng: 24.34997979642296, lat: 56.32588468619257}, {lng: 24.54515876797829, lat: 56.31725167612947}, {lng: 24.5422761403151, lat: 56.3635085872031}, {lng: 24.90847940626677, lat: 56.50556491761924}, {lng: 25.00744609276966, lat: 56.47325949907291}, {lng: 25.1877744153792, lat: 56.23978718562965}, {lng: 25.65115146110418, lat: 56.19524034806678}, {lng: 26.27870772309144, lat: 55.89094308088083}, {lng: 26.37394309649184, lat: 55.77328384618152}, {lng: 26.77620618227055, lat: 55.74704709920099}, {lng: 26.93684954000857, lat: 55.84152655791369}, {lng: 27.14658340590493, lat: 55.88485146206848}, {lng: 27.57435458974985, lat: 55.82792066307039}, {lng: 27.55287589356011, lat: 55.91323269999653}, {lng: 27.62664102827479, lat: 55.96611123905441}, {lng: 27.90852918778183, lat: 56.14145090580637}, {lng: 28.1067076468666, lat: 56.24411956443871}, {lng: 28.08047580790646, lat: 56.3947847210639}, {lng: 28.00326231824253, lat: 56.54828811522599}, {lng: 27.82329293985303, lat: 56.70751577399229}, {lng: 27.81379576428192, lat: 56.8048939559506}, {lng: 27.56862340136486, lat: 56.79484782194897}, {lng: 27.57708864525462, lat: 56.85039080861084}, {lng: 27.74018656249165, lat: 57.26976225941304}, {lng: 27.42932181217484, lat: 57.36261563361338}, {lng: 27.38457501952352, lat: 57.46241620485802}, {lng: 26.92870676092158, lat: 57.54714289291167}, {lng: 26.61492260800171, lat: 57.46559663708699}, {lng: 26.2644018257886, lat: 57.5555644565338}, {lng: 26.086673287501, lat: 57.70656512771597}, {lng: 26.03335852389512, lat: 57.74350018206077}, {lng: 25.9609145848242, lat: 57.77048152911083}, {lng: 25.85323238445614, lat: 57.8127418962866}, {lng: 25.69600221114806, lat: 57.85891394824351}, {lng: 25.49151542422119, lat: 57.91884629182784}, {lng: 25.26265431405445, lat: 57.95715187498595}, {lng: 25.01918865340179, lat: 57.96871510769301}, {lng: 24.8277910522001, lat: 57.93725435575551}, {lng: 24.53966793716774, lat: 57.91271260572776}, {lng: 24.52616174040707, lat: 57.85996422373446}, {lng: 24.29751471311357, lat: 57.83779941598686}, {lng: 24.34338588942506, lat: 57.27255671693709}, {lng: 23.33855078204521, lat: 57.11769007439793}, {lng: 23.18788280603546, lat: 57.37752173242747}, {lng: 22.61689028396331, lat: 57.80119834781119}];
let gamemode = 3;

function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function setGamemode(num) {
    gamemode=num;
    initialize();
}

async function getCoordsFromBackend() {
    const locRes = await fetch('/api/location/' + gamemode + '?seed='+ nejausaSekla + '&roundCount=' + panoCounter, {method: "GET"});
    if (locRes.ok) {
        const buffer = await locRes.arrayBuffer();
        const view = new Float64Array(buffer);
        const latLongLiteral = {
            lat: view[0],
            lng: view[1]
        };
        console.log(latLongLiteral);
        return latLongLiteral;
    } 
}

async function getCoords() {
    if (redpill) {
        return getCoordsFromBackend();  
    } else {
        return getCoordsLocal();
    }
}

function getCoordsLocal(){
    let coords;
    do {
        coords = getLatviaBox();
    } while (!point_in_polygon(coords, latvia)); //find coords that lie within the polygon of latvia within a few iterations
    return coords;
}

function getLatviaBox() { //returns random coordinates in a large box around Latvia, coordinates might not be in Latvia,
    const latitude = parseFloat(getRndInteger(55000000, 58200000))/1000000;
    const longitude = parseFloat(getRndInteger(20800000, 28500000))/1000000; 
    const latLongLiteral = {lat: latitude, lng: longitude};
    return latLongLiteral;
}

function point_in_polygon(point, polygon) {
    const num_vertices = polygon.length;
    const x = point.lat;
    const y = point.lng;
    let inside = false;
 
    let p1 = polygon[0];
    let p2; 
    for (let i = 1; i <= num_vertices; i++) {
        p2 = polygon[i % num_vertices];
        if (y > Math.min(p1.lng, p2.lng)) {
            if (y <= Math.max(p1.lng, p2.lng)) {
                if (x <= Math.max(p1.lat, p2.lat)) {
                    const x_intersection = ((y - p1.lng) * (p2.lat - p1.lat)) / (p2.lng - p1.lng) + p1.lat;
                    if (p1.lat === p2.lat || x <= x_intersection) {
                        inside = !inside;
                    }
                }
            }
        }
 
        p1 = p2;
    }
 
    return inside;
}