import { Hono } from "hono";
import Database from "../../database/database";
let dobele = [{lng: 23.2549502, lat: 56.6418708}, {lng: 23.25491, lat: 56.6419375}, {lng: 23.254894, lat: 56.6419575}, {lng: 23.2548068, lat: 56.6420666}, {lng: 23.2536552, lat: 56.643277}, {lng: 23.2541308, lat: 56.6433869}, {lng: 23.2566381, lat: 56.6439664}, {lng: 23.2570565, lat: 56.6441297}, {lng: 23.25748, lat: 56.6442951}, {lng: 23.2577658, lat: 56.6444067}, {lng: 23.2581165, lat: 56.6446374}, {lng: 23.257966, lat: 56.6447322}, {lng: 23.258156, lat: 56.6451329}, {lng: 23.2597111, lat: 56.6443688}, {lng: 23.2600828, lat: 56.6441124}, {lng: 23.2609551, lat: 56.6437022}, {lng: 23.2629163, lat: 56.6438716}, {lng: 23.2645157, lat: 56.6440155}, {lng: 23.2645642, lat: 56.6440467}, {lng: 23.2651401, lat: 56.6437748}, {lng: 23.2652655, lat: 56.6437265}, {lng: 23.2668187, lat: 56.6431282}, {lng: 23.2668663, lat: 56.6431657}, {lng: 23.2707044, lat: 56.6442777}, {lng: 23.2711321, lat: 56.6452888}, {lng: 23.2720677, lat: 56.6452841}, {lng: 23.2741462, lat: 56.6452736}, {lng: 23.2775107, lat: 56.6452566}, {lng: 23.2769503, lat: 56.6439966}, {lng: 23.2764919, lat: 56.6429268}, {lng: 23.2754048, lat: 56.6408394}, {lng: 23.2764032, lat: 56.6395361}, {lng: 23.2778406, lat: 56.63796}, {lng: 23.2795621, lat: 56.6377445}, {lng: 23.2814739, lat: 56.6373565}, {lng: 23.2824331, lat: 56.6371504}, {lng: 23.2831481, lat: 56.6369797}, {lng: 23.2848016, lat: 56.636585}, {lng: 23.2856352, lat: 56.6363818}, {lng: 23.2859311, lat: 56.6363152}, {lng: 23.286421, lat: 56.6362182}, {lng: 23.2549502, lat: 56.6418708}, {lng: 23.2553733, lat: 56.6419867}, {lng: 23.255769, lat: 56.6420593}, {lng: 23.2563076, lat: 56.6420704}, {lng: 23.2567475, lat: 56.6420574}, {lng: 23.2572723, lat: 56.6420527}, {lng: 23.2576406, lat: 56.6420705}, {lng: 23.2579402, lat: 56.6419785}, {lng: 23.2582412, lat: 56.6418162}, {lng: 23.2584029, lat: 56.6415281}, {lng: 23.2584953, lat: 56.6411536}, {lng: 23.2586437, lat: 56.6408185}, {lng: 23.2588186, lat: 56.6405773}, {lng: 23.2588604, lat: 56.6405466}, {lng: 23.2587522, lat: 56.6404424}, {lng: 23.2583899, lat: 56.6400939}, {lng: 23.2581105, lat: 56.6398591}, {lng: 23.2569745, lat: 56.6392573}, {lng: 23.2563448, lat: 56.6389238}, {lng: 23.2563428, lat: 56.6389227}, {lng: 23.2560167, lat: 56.6387704}, {lng: 23.2565245, lat: 56.6384605}, {lng: 23.257145, lat: 56.638023}, {lng: 23.2573368, lat: 56.6378683}, {lng: 23.2575763, lat: 56.6376292}, {lng: 23.2577912, lat: 56.6373677}, {lng: 23.2578751, lat: 56.6372823}, {lng: 23.2586311, lat: 56.6361174}, {lng: 23.2597264, lat: 56.6346705}, {lng: 23.2602594, lat: 56.6340248}, {lng: 23.2609098, lat: 56.6331637}, {lng: 23.2610552, lat: 56.633171}, {lng: 23.261266, lat: 56.6329239}, {lng: 23.2616478, lat: 56.632334}, {lng: 23.2620099, lat: 56.6319081}, {lng: 23.2622255, lat: 56.6316625}, {lng: 23.2624885, lat: 56.6314262}, {lng: 23.2631585, lat: 56.6308042}, {lng: 23.2642324, lat: 56.6298025}, {lng: 23.2655067, lat: 56.6286717}, {lng: 23.2664291, lat: 56.6277786}, {lng: 23.2667473, lat: 56.6274706}, {lng: 23.2670665, lat: 56.6270965}, {lng: 23.2670472, lat: 56.6270231}, {lng: 23.2670579, lat: 56.6270103}, {lng: 23.2673585, lat: 56.6266947}, {lng: 23.2674601, lat: 56.6266013}, {lng: 23.2675642, lat: 56.6266272}, {lng: 23.2677259, lat: 56.6264193}, {lng: 23.2678844, lat: 56.6262016}, {lng: 23.2678085, lat: 56.6261806}, {lng: 23.2679968, lat: 56.6259332}, {lng: 23.2682164, lat: 56.6256394}, {lng: 23.2682344, lat: 56.6256074}, {lng: 23.2684339, lat: 56.6253505}, {lng: 23.2684357, lat: 56.6253481}, {lng: 23.2684693, lat: 56.6252933}, {lng: 23.2684749, lat: 56.6252857}, {lng: 23.2686584, lat: 56.6250483}, {lng: 23.268753, lat: 56.6250711}, {lng: 23.2689228, lat: 56.6248571}, {lng: 23.2691688, lat: 56.6245083}, {lng: 23.2692628, lat: 56.6242683}, {lng: 23.2693435, lat: 56.6241594}, {lng: 23.2696682, lat: 56.6237224}, {lng: 23.2700405, lat: 56.6232542}, {lng: 23.2701424, lat: 56.6231261}, {lng: 23.2687053, lat: 56.6233689}, {lng: 23.2683472, lat: 56.6232696}, {lng: 23.2680322, lat: 56.6231853}, {lng: 23.2676214, lat: 56.6230784}, {lng: 23.2674838, lat: 56.6230426}, {lng: 23.2673292, lat: 56.6230024}, {lng: 23.2670294, lat: 56.6229243}, {lng: 23.2665721, lat: 56.6228092}, {lng: 23.2663297, lat: 56.6227634}, {lng: 23.2655722, lat: 56.6226217}, {lng: 23.2652844, lat: 56.6225679}, {lng: 23.2647592, lat: 56.6224697}, {lng: 23.2645748, lat: 56.6224352}, {lng: 23.2643724, lat: 56.6223974}, {lng: 23.2639857, lat: 56.6223251}, {lng: 23.2636155, lat: 56.622256}, {lng: 23.2633037, lat: 56.6221977}, {lng: 23.2635959, lat: 56.6216146}, {lng: 23.2636615, lat: 56.6214837}, {lng: 23.263779, lat: 56.6212493}, {lng: 23.2639442, lat: 56.6209197}, {lng: 23.2640244, lat: 56.6207596}, {lng: 23.2642059, lat: 56.6203974}, {lng: 23.2642828, lat: 56.6202432}, {lng: 23.2644037, lat: 56.6200006}, {lng: 23.2645156, lat: 56.619776}, {lng: 23.264657, lat: 56.6194924}, {lng: 23.2649042, lat: 56.6193018}, {lng: 23.2650501, lat: 56.6193565}, {lng: 23.2656862, lat: 56.6195026}, {lng: 23.2658759, lat: 56.619244}, {lng: 23.2660728, lat: 56.6189757}, {lng: 23.2662387, lat: 56.6184125}, {lng: 23.2665861, lat: 56.6172331}, {lng: 23.2667211, lat: 56.6167853}, {lng: 23.2670105, lat: 56.6158194}, {lng: 23.2704949, lat: 56.6161269}, {lng: 23.2712888, lat: 56.6161969}, {lng: 23.2726014, lat: 56.6163127}, {lng: 23.2727439, lat: 56.6154446}, {lng: 23.2727691, lat: 56.6153173}, {lng: 23.272853, lat: 56.6148941}, {lng: 23.2728554, lat: 56.6148856}, {lng: 23.272866, lat: 56.6148417}, {lng: 23.2732549, lat: 56.6131776}, {lng: 23.2735833, lat: 56.6117296}, {lng: 23.2736954, lat: 56.6112474}, {lng: 23.2739646, lat: 56.6101931}, {lng: 23.2740669, lat: 56.6098736}, {lng: 23.274183, lat: 56.6095248}, {lng: 23.2744844, lat: 56.6086192}, {lng: 23.2744846, lat: 56.6086192}, {lng: 23.274564, lat: 56.6084203}, {lng: 23.2746775, lat: 56.6081364}, {lng: 23.2747523, lat: 56.6079625}, {lng: 23.2749792, lat: 56.607435}, {lng: 23.2755822, lat: 56.6059871}, {lng: 23.2758132, lat: 56.6055286}, {lng: 23.2759976, lat: 56.605227}, {lng: 23.2763548, lat: 56.6047533}, {lng: 23.2764681, lat: 56.6046237}, {lng: 23.2764976, lat: 56.60459}, {lng: 23.2785501, lat: 56.6023317}, {lng: 23.2798818, lat: 56.6007687}, {lng: 23.2803138, lat: 56.6008149}, {lng: 23.2850219, lat: 56.6013066}, {lng: 23.2864213, lat: 56.6014384}, {lng: 23.2865265, lat: 56.6014483}, {lng: 23.2866189, lat: 56.601457}, {lng: 23.2864308, lat: 56.6017116}, {lng: 23.2863853, lat: 56.6017553}, {lng: 23.2863325, lat: 56.6018063}, {lng: 23.2858512, lat: 56.6020307}, {lng: 23.2850272, lat: 56.6023269}, {lng: 23.2847961, lat: 56.6025293}, {lng: 23.2844297, lat: 56.6026714}, {lng: 23.2840299, lat: 56.6027756}, {lng: 23.2835949, lat: 56.6029424}, {lng: 23.2832285, lat: 56.6030845}, {lng: 23.2830203, lat: 56.6032713}, {lng: 23.2830406, lat: 56.6034031}, {lng: 23.2833788, lat: 56.6035492}, {lng: 23.2837511, lat: 56.6036956}, {lng: 23.2844297, lat: 56.603875}, {lng: 23.2852469, lat: 56.6041879}, {lng: 23.2854455, lat: 56.6040671}, {lng: 23.287117, lat: 56.6036298}, {lng: 23.2871115, lat: 56.6032825}, {lng: 23.2871342, lat: 56.6029177}, {lng: 23.2874682, lat: 56.6026103}, {lng: 23.2880704, lat: 56.6026295}, {lng: 23.2887869, lat: 56.6027496}, {lng: 23.2888212, lat: 56.6026928}, {lng: 23.3097257, lat: 56.6183485}, {lng: 23.3094354, lat: 56.6179553}, {lng: 23.3074534, lat: 56.6185949}, {lng: 23.3065117, lat: 56.6189482}, {lng: 23.3058555, lat: 56.6191945}, {lng: 23.3050528, lat: 56.6194448}, {lng: 23.3034561, lat: 56.6199479}, {lng: 23.3021354, lat: 56.6203738}, {lng: 23.3012432, lat: 56.6206835}, {lng: 23.2986528, lat: 56.6215647}, {lng: 23.2973828, lat: 56.6220665}, {lng: 23.2945524, lat: 56.6230385}, {lng: 23.2946459, lat: 56.623137}, {lng: 23.2941753, lat: 56.6233432}, {lng: 23.2935434, lat: 56.6236392}, {lng: 23.2930323, lat: 56.6238749}, {lng: 23.2922118, lat: 56.6234236}, {lng: 23.2921189, lat: 56.6233613}, {lng: 23.2922158, lat: 56.6233125}, {lng: 23.292313, lat: 56.6232592}, {lng: 23.2923182, lat: 56.6232506}, {lng: 23.2930595, lat: 56.6220213}, {lng: 23.2925909, lat: 56.6208206}, {lng: 23.2925423, lat: 56.620669}, {lng: 23.2925421, lat: 56.6205471}, {lng: 23.2932281, lat: 56.6205391}, {lng: 23.2928451, lat: 56.6202947}, {lng: 23.2898641, lat: 56.6184839}, {lng: 23.2893538, lat: 56.6180171}, {lng: 23.2894237, lat: 56.6179151}, {lng: 23.2896684, lat: 56.6175582}, {lng: 23.2897547, lat: 56.6174286}, {lng: 23.2895913, lat: 56.6171945}, {lng: 23.2897412, lat: 56.616864}, {lng: 23.291341, lat: 56.6161292}, {lng: 23.2939724, lat: 56.6148574}, {lng: 23.2940807, lat: 56.6147721}, {lng: 23.2941391, lat: 56.614725}, {lng: 23.294201, lat: 56.6146759}, {lng: 23.2942708, lat: 56.6146218}, {lng: 23.2942504, lat: 56.6146141}, {lng: 23.2941832, lat: 56.6145888}, {lng: 23.2941289, lat: 56.6145677}, {lng: 23.2940688, lat: 56.6145443}, {lng: 23.293621, lat: 56.61437}, {lng: 23.2936882, lat: 56.6143177}, {lng: 23.2937522, lat: 56.6142679}, {lng: 23.293816, lat: 56.6142183}, {lng: 23.2939128, lat: 56.614143}, {lng: 23.2940021, lat: 56.6140735}, {lng: 23.2939382, lat: 56.6140473}, {lng: 23.2938837, lat: 56.6140255}, {lng: 23.2938271, lat: 56.6140024}, {lng: 23.2937709, lat: 56.6139794}, {lng: 23.2938307, lat: 56.6139352}, {lng: 23.2939485, lat: 56.6138474}, {lng: 23.2940229, lat: 56.6138141}, {lng: 23.2940621, lat: 56.6138287}, {lng: 23.2940984, lat: 56.6138436}, {lng: 23.2941553, lat: 56.613802}, {lng: 23.2942165, lat: 56.6137573}, {lng: 23.2942777, lat: 56.6137126}, {lng: 23.2943363, lat: 56.6136697}, {lng: 23.2943923, lat: 56.6136932}, {lng: 23.2944253, lat: 56.6137069}, {lng: 23.2944809, lat: 56.6136647}, {lng: 23.2945376, lat: 56.6136216}, {lng: 23.2945974, lat: 56.6135761}, {lng: 23.294653, lat: 56.6135339}, {lng: 23.2947386, lat: 56.6135687}, {lng: 23.2960117, lat: 56.6126336}, {lng: 23.2963538, lat: 56.61237}, {lng: 23.2972751, lat: 56.6118551}, {lng: 23.2976043, lat: 56.6116439}, {lng: 23.2969137, lat: 56.6113744}, {lng: 23.2966971, lat: 56.6115289}, {lng: 23.2961135, lat: 56.6112799}, {lng: 23.2956841, lat: 56.611581}, {lng: 23.2955504, lat: 56.6115221}, {lng: 23.2950357, lat: 56.6112748}, {lng: 23.2951347, lat: 56.6112038}, {lng: 23.2956687, lat: 56.6108197}, {lng: 23.295838, lat: 56.6107009}, {lng: 23.2963439, lat: 56.610914}, {lng: 23.2966966, lat: 56.6106642}, {lng: 23.2967025, lat: 56.6106599}, {lng: 23.2967766, lat: 56.6106048}, {lng: 23.2955094, lat: 56.6100494}, {lng: 23.2968377, lat: 56.6089812}, {lng: 23.2970506, lat: 56.6088295}, {lng: 23.2974164, lat: 56.6085652}, {lng: 23.2981168, lat: 56.6080024}, {lng: 23.2981697, lat: 56.6079536}, {lng: 23.2987378, lat: 56.6074289}, {lng: 23.2984697, lat: 56.607357}, {lng: 23.2977958, lat: 56.6071763}, {lng: 23.2972685, lat: 56.6070349}, {lng: 23.2971363, lat: 56.6069994}, {lng: 23.2966937, lat: 56.6068807}, {lng: 23.2965723, lat: 56.6068043}, {lng: 23.295517, lat: 56.6061704}, {lng: 23.2946758, lat: 56.6056396}, {lng: 23.2939851, lat: 56.605189}, {lng: 23.2928812, lat: 56.6044737}, {lng: 23.2927533, lat: 56.6044174}, {lng: 23.2927049, lat: 56.6043825}, {lng: 23.2922126, lat: 56.6040825}, {lng: 23.2918073, lat: 56.6038355}, {lng: 23.2924075, lat: 56.6035131}, {lng: 23.2927473, lat: 56.6033305}, {lng: 23.2926806, lat: 56.6032839}, {lng: 23.2922597, lat: 56.6029846}, {lng: 23.2921337, lat: 56.6028949}, {lng: 23.2917128, lat: 56.6025956}, {lng: 23.2912803, lat: 56.6026794}, {lng: 23.290798, lat: 56.6027729}, {lng: 23.2903701, lat: 56.6028558}, {lng: 23.2903193, lat: 56.6028657}, {lng: 23.2892068, lat: 56.6026966}, {lng: 23.2888212, lat: 56.6026928}, {lng: 23.286421, lat: 56.6362182}, {lng: 23.2864926, lat: 56.6361886}, {lng: 23.2866677, lat: 56.6361262}, {lng: 23.2877858, lat: 56.6358075}, {lng: 23.2891503, lat: 56.6354185}, {lng: 23.2898788, lat: 56.6351467}, {lng: 23.2900142, lat: 56.6351147}, {lng: 23.2921595, lat: 56.6342647}, {lng: 23.2937369, lat: 56.6336304}, {lng: 23.2952962, lat: 56.6330636}, {lng: 23.2953608, lat: 56.6330449}, {lng: 23.2953992, lat: 56.6330338}, {lng: 23.295454, lat: 56.6330228}, {lng: 23.2956324, lat: 56.6329809}, {lng: 23.2967305, lat: 56.632723}, {lng: 23.2974009, lat: 56.6325224}, {lng: 23.2977358, lat: 56.6323595}, {lng: 23.2981883, lat: 56.6321832}, {lng: 23.29919, lat: 56.6317765}, {lng: 23.2997301, lat: 56.6313666}, {lng: 23.3007192, lat: 56.6300577}, {lng: 23.3010356, lat: 56.6301876}, {lng: 23.3024715, lat: 56.6307421}, {lng: 23.3029021, lat: 56.6308859}, {lng: 23.3031379, lat: 56.6309451}, {lng: 23.3037573, lat: 56.6311004}, {lng: 23.3039614, lat: 56.6309074}, {lng: 23.3039858, lat: 56.6308846}, {lng: 23.3050458, lat: 56.6298927}, {lng: 23.3053358, lat: 56.6296223}, {lng: 23.306494, lat: 56.6285423}, {lng: 23.3078716, lat: 56.6272599}, {lng: 23.3121823, lat: 56.6232493}, {lng: 23.310901, lat: 56.6220839}, {lng: 23.3098507, lat: 56.6211287}, {lng: 23.3096844, lat: 56.6209775}, {lng: 23.3093887, lat: 56.6207139}, {lng: 23.3108746, lat: 56.6200427}, {lng: 23.3115666, lat: 56.6197249}, {lng: 23.3113771, lat: 56.6195127}, {lng: 23.3097257, lat: 56.6183485}]


//this should be in DB later, currently is [gamemodeID][locationID][lat/lon/max/min]
let locationStore = []

function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function getCoords(){
    let coords;
    do {
        coords = getLatviaBox();
    } while (!point_in_polygon(coords, dobele)); //find coords that lie within the polygon of latvia within a few iterations
    return coords;
}

function getLatviaBox() { //returns random coordinates in a large box around Latvia, coordinates might not be in Latvia,
    const latitude = parseFloat(getRndInteger(56600769, 56645289))/1000000;
    const longitude = parseFloat(getRndInteger(23253655, 23312182))/1000000;
    const latLongLiteral = {lat: latitude, lng: longitude};
    return latLongLiteral;
}

function point_in_polygon(point, polygon) {
    const num_vertices = polygon.length;
    const x = point.lat;
    const y = point.lng;
    let inside = false;

    let p1 = polygon[0];
    let p2;
    for (let i = 1; i <= num_vertices; i++) {
        p2 = polygon[i % num_vertices];
        if (y > Math.min(p1.lng, p2.lng)) {
            if (y <= Math.max(p1.lng, p2.lng)) {
                if (x <= Math.max(p1.lat, p2.lat)) {
                    const x_intersection = ((y - p1.lng) * (p2.lat - p1.lat)) / (p2.lng - p1.lng) + p1.lat;
                    if (p1.lat === p2.lat || x <= x_intersection) {
                        inside = !inside;
                    }
                }
            }
        }

        p1 = p2;
    }

    return inside;
}

async function pregen() {
    let gamemodeID = 0;
    let locationID = 0;
    if (!locationStore[gamemodeID]) {
        locationStore[gamemodeID] = [];
    }
    while (locationID<1000) {
        if (!locationStore[gamemodeID][locationID]) {
            locationStore[gamemodeID][locationID] = [];
        }
        let coords = getCoords();
        locationStore[gamemodeID][locationID][0] = coords.lat;
        locationStore[gamemodeID][locationID][1] = coords.lng;
        console.log(coords);
        locationID++;
    }
}


const apiLocation = new Hono()
    .get('/:gamemode', async (c) => {
        let gamemode = parseInt(c.req.param('gamemode'));
        let locationID = getRndInteger(0,1000-1);
        let location = locationStore[gamemode][locationID];
        return c.json({lat: location[0], lon: location[1]});
    });

pregen()
export default apiLocation;
